---
title: Swift의 메모리 회수 정책
date: 2023-01-11 22:00:00 +0900
categories: [Programming, Swift]
tags: [swift, ARC]     # TAG names should always be lowercase
---

Swift 예문 등을 살펴보면, 변수 선언 시에 var 앞에 weak 등의 단어를 지정하는 경우가 있는데, 이게 뭘까? 약한 변수? 무엇이 약하다는 거지?
```swift
weak var example = Example()
```

간단히 찾아보니 이것은 Swift 의 메모리 누수 방지를 위한 정책으로, 그 종류에는 **Strong**, **Weak**, **Unowned** 가 있다고 하는데, 메모리 누수란 무엇이며, 이런 정책은 왜 필요하고, 또 일반적으로 많이 쓰이는 방법은 무엇인지 알아보기로 하자.

## 메모리 누수란?
메모리 누수란 컴퓨터 내에서 동작하고 있는 프로그램이 더 이상 필요하지 않은 메모리를 계속해서 점유하고 있는 상황이다. 주로 프로그램이 메모리를 할당받아 사용한 후에, 필요없어진 시점에 해제하지 않아 발생한다.<br>
흔히들 컴퓨터의 메모리를 *작업용 책상*에 비유하고는 하는데, 내가 다 읽고 더이상 볼 일이 없는 책을 계속 책상 위에 올려두어서 다른 작업을 진행하는 데에 방해를 주는 것을 말한다고 볼 수 있다.<br>
청소를 제때제때 하라는 의미... 개인적으로는 메모리 누수라는 용어는 덜 직관적인 느낌이다. 메모리 점유?, 메모리 낭비? 같은 용어가 더 한번에 이해하기는 쉬운 것 같다. ~~영어로도 memory leak 이지만..~~

### 메모리 참조 순환이란?
곁다리로 메모리 누수와 함께 자주 등장하는 개념, 참조 순환에 대해서도 알아보자. 이는 서로 다른 객체가 서로를 참조하고 있는 상황을 말한다. 예를 들어, 객체 A가 객체 B를 참조하고, 동시에 객체 B도 객체 A를 참조하고 있으면, 이 둘은 서로를 '참조 순환'하고 있다고 말할 수 있는데, 이때 두 객체 모두 자신이 아직 다른 객체에 의해 필요하다고 생각하기 때문에 계속해서 메모리 해제가 되지 않고 결과적으로 메모리 누수가 발생하게 된다.

## Swift 메모리 회수 정책의 종류
다시 돌아와 Swift 의 메모리 회수 정책과 그 종류에 대해 살펴보자.<br>
Swift의 메모리 회수 정책에는 '강한 참조(Strong Reference)', '약한 참조(Weak Reference)', 그리고 '소유되지 않은(Unowned Reference) 참조' 세 가지가 있고, 모두 참조 카운팅 (ARC;Automatic Referece Counting) 을 통해 관리하는 방법이다.

>자세한 내용은 Swift 공식 도큐먼트에서도 다루고 있다.<br>
[Automatic Reference Counting](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/automaticreferencecounting/)

### Strong
일반적으로 많이 쓰이는 Swift 메모리 회수 정책은 '강한 참조'이고, 변수 선언 시에 별다르게 정책 지정이 없으면 디폴트로 Strong 이 부여된다. ARC 는 해당 객체가 어디 하나에서라도 참조되고 있다고 판단하면 메모리를 해제하지 않는다.<br>
그렇기 때문에, Strong 만을 사용해서는 위에서 언급한 것과 같은 참조 순환이 발생할 위험이 있고, 이를 방지하기 위해 Weak 과 Unowned 도 적절히 겸용해야 한다. (참조 순환 위험이 있는 두 객체 중 하나를 Weak 로 지정한다든지)

### Weak, Unowned
'약한 참조'와 '소유되지 않은 참조'는 Strong 과 달리 메모리를 점유하지 않고 금방 해제한다는 점에서 비슷해 보이지만, 약간 다른 경우에 사용한다.<br>
Weak 는 참조할 수 있는 객체가 없을 때 nil이 될 수 있어야 할 때 사용한다. Weak를 지정한 객체는 생성은 되지만 직후에 바로 nil 상태가 되기 때문에 옵셔널로 지정해야 한다. 반면, Unowned 는 객체 생성과 동시에 해제되며 nil 상태가 되는 것도 아니기 때문에 항상 참조할 객체가 있을 것이라는 것이 보장될 때, 개발자에 의해 라이프사이클이 명확히 제어될 수 있을때 사용한다. 즉, Weak 는 옵셔널이며, Unowned 는 비옵셔널이라고 볼 수 있다.

#### 옵셔널은 또 뭔데?
Swift 의 옵셔널(Optional)은 변수 또는 상수의 값이 없을 수도 있다('nil'일 수 있다)는 것을 나타내는 타입이다. ~~(까보기 전에 모른다)~~ 안전성을 중요하게 생각하는 Swift의 특징 중 하나로, 값이 없는 상황을 명시적으로 처리하도록 강제하여 실행 시점의 오류를 줄이고자 한다. 옵셔널은 변수 또는 상수가 '값을 가지고 있다' 또는 '값이 없다(nil)' 두 가지 상태 중 하나를 가질 수 있고. 이를 통해 개발자는 값이 없는 상황을 안전하게 처리할 수 있다.

